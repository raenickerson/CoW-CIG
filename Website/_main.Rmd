--- 
title: "My semester project website"
author: "Rae Nickerson"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This will be my end of semester project webpage showing the progress on my
  organizing of my data for the CoW-CIG. 
link-citations: yes
github-repo: rstudio/bookdown-demo
output: 
  html_document:
    toc: true
    toc_depth: 4
    toc-title: "Table of Contents"
# For some reason this code to make a table of contents is not working
---

# About

The CoW-CIG (Conservation on Workinglands Conservation Innovation Grant Team) is 
a group of livestock producers, researchers, graduate students, and NGO partners
working together to evaluate the effectiveness of nonlethal tools at reducing 
conflicts between livestock, wolves, and grizzly bears. My work focuses on range 
riding - a tool where riders provide human presence among a livestock herd while
monitoring and managing the activity of livestock and predators. 

This semester project will focus on organizing my database, and visualizing predator presence across camera site locations from our pilot in eastern Washington. 

<!--chapter:end:index.Rmd-->

# Creating My Database

This chapter will focus on creating the database for my predator data. Sources of
predator data include 1. my game cameras, 2. data from range rider data sheets, 
3. data from range rider/ranch game cameras, and 4. data from wildlife agencies 
(sightings, collar data, and conflict data).

  
```{r diagram, eval=TRUE, echo=FALSE, out.width='100%', fig.align='center', fig.cap="Diagram Illustrating the Structure of the Database"}
knitr::include_graphics("img/database_design.PNG")
```
  
Unfortunately, I will only have camera data from our pilot to analyze at this time, so I will
be focusing on a new table I created just for this task (not listed here in this database). However, when analyzing our actual data, I will be using the tables Cameras, Photos, Rides, and Predator_Agency to consolidate all predator data for a single season, by location. Colored lines represent variables shared
across tables.

## Starting the Databse {-}

I'll start by loading the `DBI` and `RSQLite` packages:
```{r pkg, eval = TRUE, echo = TRUE, warning = FALSE, message = FALSE, error = FALSE}
library(DBI)
library(RSQLite)
library(ggplot2)
library(dplyr)
```

## Creating the database connection to my SQLite database {-}

```{r connection, eval = TRUE, echo = TRUE}
cow_cig_db <- dbConnect(RSQLite::SQLite(), 
                    "CoW_CIG.db")
```

## Creating the cameras table

This table includes all information about deployed cameras at each field site, including camera serial numbers, personnel deployed, total pictures, height, percent cover at location, and more. The `deploy_id` column contains a unique identifier, and as such, is the primary key of the table. All tables in this study are connected by the `ranch_id` variable.

```{r cameras-table, eval = FALSE, echo = TRUE}
dbExecute(cow_cig_db, "CREATE TABLE cameras (
                          deploy_id integer PRIMARY KEY AUTOINCREMENT,
                          camera_id varchar(10),
                          ranch_id varchar(10),
                          station_id varchar(5),
                          date_deploy text, 
                          person_deploy varchar(10) CHECK (person_deploy IN ('Rae', 'tech1', 'tech2')),
                          date_pull text,
                          person_remove varchar(10) CHECK (person_remove IN ('Rae', 'tech1', 'tech2')),
                          lat double,
                          long double,
                          pasture_id varchar(10),
                          dist_target_m char(3),
                          height_f char(3),
                          width char(3),
                          cover_percent char(20),
                          direction varchar(20) CHECK (direction IN ('N', 'S', 'E', 'W', 'NW', 
                          'NE', 'SW', 'SE')),
                          habitat varchar(20),
                          lock char(1),
                          S_B_date text,
                          date_check text,
                          person_check text CHECK (person_check IN ('Rae', 'tech1', 'tech2')), 
                          total_pics char(20),
                          pics_delete char(20),
                          date_dead text,
                          date_full text,
                          FOREIGN KEY (ranch_id) REFERENCES ranches(ranch_id),
                          FOREIGN KEY (camera_id) REFERENCES cameras(camera_id),
                          FOREIGN KEY (person_deploy) REFERENCES cameras(person_deployed),
                          FOREIGN KEY (pasture_id) REFERENCES pastures(pasture_id),
                          FOREIGN KEY (person_remove) REFERENCES cameras(person_removed)
                          );")
```

Preview of the cameras table:

```{r show-cameras, eval = TRUE, echo = FALSE}
dbGetQuery(cow_cig_db, "SELECT * FROM cameras LIMIT 20;")
```

## Creating the photos table

This table includes all information related to each individual photo from all game cameras across sites, including observer name, behavior of the cattle in each photo, species, number of individuals, and more. The `photo_id` column contains a unique identifier, and as such, is the primary key of the table.

```{r photos-table, eval = FALSE, echo = TRUE}
dbExecute(cow_cig_db, "CREATE TABLE photos (
                          photo_id integer PRIMARY KEY AUTOINCREMENT,
                          ranch_id varchar(20),
                          camera_id varchar(10),
                          date text,
                          observer_id varchar(10) CHECK (observer_id IN ('Rae', 'tech1', 'tech2')),
                          weather_id varchar(10),
                          temp char(3),
                          time char(4),
                          lat double,
                          long double,
                          species_id varchar(10),
                          pred_num char(3),
                          num_other char(3),
                          num_calves char(3),
                          num_bulls char(3),
                          num_cows char(3),
                          num_cattle char(3),
                          event char(5),
                          event_start char(4),
                          event_end char(4),
                          eat_up_bulls char(3), 
                          eat_up_cows char(3),
                          eat_up_calves char(3),
                          eat_down_bulls char(3), 
                          eat_down_cows char(3),
                          eat_down_calves char(3),
                          stand_up_bulls char(3), 
                          stand_up_cows char(3),
                          stand_up_calves char(3),
                          stand_down_bulls char(3), 
                          stand_down_cows char(3),
                          stand_down_calves char(3),
                          walk_up_bulls char(3), 
                          walk_up_cows char(3),
                          walk_up_calves char(3),
                          walk_down_bulls char(3), 
                          walk_down_cows char(3),
                          walk_down_calves char(3),
                          lying_bulls char(3), 
                          lying_cows char(3),
                          lying_calves char(3),
                          running_bulls char(3), 
                          running_cows char(3),
                          running_calves char(3),
                          other_bulls char(3), 
                          other_cows char(3),
                          other_calves char(3),
                          dom_behav varchar(10),
                          FOREIGN KEY (ranch_id) REFERENCES ranches(ranch_id),
                          FOREIGN KEY (camera_id) REFERENCES cameras(camera_id),
                          FOREIGN KEY (observer_id) REFERENCES cameras(observer_id),
                          FOREIGN KEY (species_id) REFERENCES photos(species_id),
                          FOREIGN KEY (num_calves) REFERENCES photos(num_calves),
                          FOREIGN KEY (num_cows) REFERENCES photos(num_cows),
                          FOREIGN KEY (num_bulls) REFERENCES photos(num_bulls),
                          FOREIGN KEY (num_other) REFERENCES photos(num_other),
                          FOREIGN KEY (num_cattle) REFERENCES photos(num_cattle),
                          FOREIGN KEY (pred_num) REFERENCES photos(pred_num)
                          );")
```

Preview of the photos table:
```{r show-photos, eval = TRUE, echo = FALSE}
dbGetQuery(cow_cig_db, "SELECT * FROM photos LIMIT 20;")
```

## Creating the WA_DM table (pilot data)

This table includes all information about deployed cameras at our pilot field site in Washington from the summer of 2021, including photo id, date, camera model, camera id, station id, species, number of individuals, and number of individuals per photo event. The `photo_id` column contains a unique identifier, and as such, is the primary key of the table.

```{r cameras-table, eval = FALSE, echo = TRUE}
dbExecute(cow_cig_db, "CREATE TABLE WA_DM_F (
                          photo_id integer PRIMARY KEY AUTOINCREMENT,
                          date_pic text,
                          cam_model varchar(10), 
                          cam_id varchar(10),
                          station_id varchar(10),
                          species_id varchar(10),
                          num char(20),
                          num_individ_pics char(20)
                          );")
```

Preview of the photos table:
```{r show-photos, eval = TRUE, echo = FALSE}
dbGetQuery(cow_cig_db, "SELECT * FROM WA_DM_F LIMIT 20;")
```

<!--chapter:end:01-database.Rmd-->

# Brining in, and cleaning my data

Since my pilot data did not focus on cattle behavioral analysis, there will be little to no data on cows. Instead, I will focus on cleaning my data for visualizing wild species presence across camera sites. 

This pilot was in eastern Washington (just outside Colville) and focused on comparing cameras placed at the center of each camera grid cell to those placed on roads, trails, or other sites where we would expect to see more wildlife use - with a focus on capturing wolf presence.

## Brining in the pilot data

```{r connection, eval = TRUE, echo = TRUE}
library(tidyverse)
WAP <- dbGetQuery(cow_cig_db, "SELECT * FROM WA_DM_F;")
```

Alternative way to bring in the data: 

```{r connection, eval = TRUE, echo = TRUE}
WAP <- read.csv("WA_DM_Final.csv", na = "NA")
```

## Cleaning the data

For some reason, R is reading in my csv file to have 99+ variables. So first I will remove all unneeded columns to just have the data I will be working with for visualization later. 

```{r connection, eval = TRUE, echo = TRUE}
# species occurrence table
S_O <- WAP %>% 
  select(date_pic, cam_id, station_id, species_id, num_individ_pics)
```

Notice that I selected the "num_individ_pics" column over the "num" column. This is because the "num" column records the number of individuals per photo, regardless of whether those same individuals show up more than once in a series of pictures. To better reflect presence, we will use the "num_individ_pics" columns which has been cleaned to only have one value per individual, per photo event. 

Now let's make sure our date column is being read correctly by R using Lubridate

```{r connection, eval = TRUE, echo = TRUE}
library(lubridate)

S_O <- S_O %>% 
  mutate(date_pic = ymd(date_pic))
class(S_O$date_pic)
```

Next, let's make sure all NA's, UNKNONWS, and ?s are set to NA, and make sure our columns are the correct data class

First, let's check the class for each column (except date_pic which we've already dealt with)

```{r connection, eval = TRUE, echo = TRUE}
class(S_O$cam_id)
class(S_O$station_id)
class(S_O$species_id)
class(S_O$num_individ_pics)
```

Our num_individ_pics is the integar class, which is good, but our other variables need to be switched to as.factor so that we can categorize by cam_id, station_id, and species_id. 

```{r connection, eval = TRUE, echo = TRUE}
S_O$station_id <- as.factor(S_O$station_id)
S_O$cam_id <- as.factor(S_O$cam_id)
S_O$species_id <- as.factor(S_O$species_id)
```

Now, let's check that it worked

```{r connection, eval = TRUE, echo = TRUE}
class(S_O$station_id)
class(S_O$species_id)
class(S_O$cam_id)
```

Next, let's standardize all the different ways that species were written using tidyverse. 

```{r connection, eval = TRUE, echo = TRUE}
S_O %>% 
  pull(species_id) %>% 
  unique()
```
As you can see, we have a bit of a mess here. So the first thing we want to do is separate the information we need from the information we don't. For example, we are only going to look at predator presence, so all other categories can be ignored (we will select for predator later). But, we need to set all versions of predators to a consistent category - predator - which includes BB (black bear), coyote, Coyote, COYOTE, mountain lion, and Mountain Lion. 

```{r connection, eval = TRUE, echo = TRUE}

```


S_O <- ifelse$species_id(S_O$species_id == "UNKNOWN", NA, S_O$species_id)
S_O
```

<!--chapter:end:02-cross-refs.Rmd-->

# Visualizing the data

Now that the data is cleaned, I'd like to use tidyverse (including ggplot)
to visualize my data. Specifically, I'd like to look at how predator presence varies across camera sites. Unfortunately, we did not capture enough wolf activity to look at just wolves, so we will look at wolves, bears, lions, bobcats, lynx, and coyotes as one "predator" category. 

First, let's create a new column where all the above listed species are changed to "predator".






<!--chapter:end:03-parts.Rmd-->

# Footnotes and citations 

## Footnotes

Footnotes are put inside the square brackets after a caret `^[]`. Like this one ^[This is a footnote.]. 

## Citations

Reference items in your bibliography file(s) using `@key`.

For example, we are using the **bookdown** package [@R-bookdown] (check out the last code chunk in index.Rmd to see how this citation key was added) in this sample book, which was built on top of R Markdown and **knitr** [@xie2015] (this citation was added manually in an external file book.bib). 
Note that the `.bib` files need to be listed in the index.Rmd with the YAML `bibliography` key.


The RStudio Visual Markdown Editor can also make it easier to insert citations: <https://rstudio.github.io/visual-markdown-editing/#/citations>

<!--chapter:end:04-citations.Rmd-->

# Blocks

## Equations

Here is an equation.

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

You may refer to using `\@ref(eq:binom)`, like see Equation \@ref(eq:binom).


## Theorems and proofs

Labeled theorems can be referenced in text using `\@ref(thm:tri)`, for example, check out this smart theorem \@ref(thm:tri).

::: {.theorem #tri}
For a right triangle, if $c$ denotes the *length* of the hypotenuse
and $a$ and $b$ denote the lengths of the **other** two sides, we have
$$a^2 + b^2 = c^2$$
:::

Read more here <https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html>.

## Callout blocks


The R Markdown Cookbook provides more help on how to use custom blocks to design your own callouts: https://bookdown.org/yihui/rmarkdown-cookbook/custom-blocks.html

<!--chapter:end:05-blocks.Rmd-->

# Sharing your book

## Publishing

HTML books can be published online, see: https://bookdown.org/yihui/bookdown/publishing.html

## 404 pages

By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If you'd like to customize your 404 page instead of using the default, you may add either a `_404.Rmd` or `_404.md` file to your project root and use code and/or Markdown syntax.

## Metadata for sharing

Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the `index.Rmd` YAML. To setup, set the `url` for your book and the path to your `cover-image` file. Your book's `title` and `description` are also used.



This `gitbook` uses the same social sharing data across all chapters in your book- all links shared will look the same.

Specify your book's source repository on GitHub using the `edit` key under the configuration options in the `_output.yml` file, which allows users to suggest an edit by linking to a chapter's source file. 

Read more about the features of this output format here:

https://pkgs.rstudio.com/bookdown/reference/gitbook.html

Or use:

```{r eval=FALSE}
?bookdown::gitbook
```



<!--chapter:end:06-share.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:07-references.Rmd-->

