#Load Package
library(DBI)

##### establish connection with database #####
Thesis_database <- dbConnect(RSQLite::SQLite(), 
                        "C:/Users/jaran/Desktop/R/Spr22Classwork/Reproducible Science/Final_Project/SQL_database/Thesis_Database.db")

class(Thesis_database)

# Sending queries to the DB ####
#dragons <- dbGetQuery(conn = dragons_db,
#           statement = "SELECT * FROM dragons;")
### MODIFY DATABASE ####

dbExecute(Thesis_database, "CREATE TABLE Lion (
                                                lion_id varchar(6) NOT NULL,
                                                sex char(1) CHECK (sex IN ('M', 'F')),
                                                age char(2),
                                                capture_date text,
                                                capture_site varchar(25),
                                                PRIMARY KEY (lion_id));")

dbExecute(Thesis_database, "Select * FROM Lion;")

dbWriteTable(Thesis_database, "Lion", Lion, append = TRUE)

dbExecute(Thesis_database, "CREATE TABLE Capture (
                                                lion_id varchar(6) NOT NULL,
                                                capture_id char(4),
                                                capture_site varchar(25),
                                                capture_date text,
                                                utm_x  float,
                                                utm_y  float,
                                                PRIMARY KEY (capture_id)
                                                FOREIGN KEY (capture_site) REFERENCES Lion(capture_site)
                                                FOREIGN KEY (lion_id) REFERENCES Lion(lion_id)
                                                FOREIGN KEY (capture_date) REFERENCES Lion(capture_date)
                                                );")

dbExecute(Thesis_database, "Select * FROM Capture;")

dbWriteTable(Thesis_database, "Captures", Capture, append = TRUE)

dbExecute(Thesis_database, "CREATE TABLE GPS_Collar (
                                                     lion_id varchar(6) NOT NULL,
                                                     capture_id char(4),
                                                     collar_id varchar(10),
                                                     make varchar(25),
                                                     model varchar(25),
                                                     deployment_start text,
                                                     deploymeny_end text,
                                                     PRIMARY KEY (collar_id)
                                                     FOREIGN KEY (capture_id) REFERENCES Capture(capture_id)
                                                     FOREIGN KEY (lion_id) REFERENCES Lion(lion_id)
                                                     );")
dbExecute(Thesis_database, "SELECT * FROM GPS_Collar;")

dbWriteTable(Thesis_database, "GPS_Collar", GPS_Collar, append = TRUE)

